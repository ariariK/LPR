/*
 *	ipcs.h
 *
 * 
 *
 *
 *
 */

#pragma once
#define KEY_NUM_SM		      1234
#define MEM_SIZE_SM	        512*4096
#define KEY_NUM_MQ_GRAB     2345
#define KEY_NUM_MQ_LPDR     3456

class Ipcs
{
//////////////////////////////////////////////////////////////////////////////////////////////////////	
// Construction
//////////////////////////////////////////////////////////////////////////////////////////////////////	
public:
	Ipcs(int key);
	virtual ~Ipcs();

//////////////////////////////////////////////////////////////////////////////////////////////////////	
// Attributes
//////////////////////////////////////////////////////////////////////////////////////////////////////	
public:

private:

protected:
  int   mq_key;
  bool  mq_created;

//////////////////////////////////////////////////////////////////////////////////////////////////////	
// Operations
//////////////////////////////////////////////////////////////////////////////////////////////////////	

/////////////////////////////////////////////////////////////////////////////////////////////////////	
// Implementation
//////////////////////////////////////////////////////////////////////////////////////////////////////	

public:
  //////////////////////////////////////////////////////////////////////////////////////////////////////	
	// IPC : Shared Memory
	//////////////////////////////////////////////////////////////////////////////////////////////////////
  int shmid;
	int SharedMemoryCreate();
  int SharedMemoryRead(char *sMemory);
	int SharedMemoryFree(void);	
  //////////////////////////////////////////////////////////////////////////////////////////////////////	

  //////////////////////////////////////////////////////////////////////////////////////////////////////	
	// IPC : Message Queue
	//////////////////////////////////////////////////////////////////////////////////////////////////////
  int msqid_grab;
  int msqid_lpdr;
	struct grab_data{
		int capWidth;
		int capHeight;
	};
	struct message_grab{
		long msg_type;
		struct grab_data data;
	};
	struct message_grab msq_grab;

  struct lpdr_data{
      long timestamp;
      char carNo[64];
  };
  struct message_lpdr{
      long msg_type;
      struct lpdr_data data;
  };
  struct message_lpdr msq_lpdr;


	int MessageQueueCreate();
  int MessageQueueInit();
	int MessageQueueQNum();
  int MessageQueueRead(char* data);
	int MessageQueueWrite(char *data);
	int MessageQueueFree();
  //////////////////////////////////////////////////////////////////////////////////////////////////////	

private:

protected:

};